function showCreateFolder(){$("body, #createFolderBox, #modal-background").toggleClass("active")}function cancelCreateFolder(){$("body, #createFolderBox, #modal-background").toggleClass("active");createFolderMessage.innerHTML="&nbsp;"}function createFolder(){var b=document.getElementById("createFolderInput").value.trim().toLowerCase();if(b==null||b==""){createFolderMessage.innerHTML="Please enter album name.";return false}if(b.length>20){createFolderMessage.innerHTML="Album name cannot have more than twenty characters.";return false}var a=/^[0-9a-zA-Z-]+$/;if(!(b.match(a))){createFolderMessage.innerHTML="Only alphanumerics and dashes are allowed in the album name.";return false}if(FL.indexOf(b)!=-1){createFolderMessage.innerHTML="Duplicate album name.";return false}$("#folders").append('<li id="f'+b+'" class="zoneList myZones" title="'+b+'"><div class="zoneName" onclick="showContents(\''+b+"')\">"+b+'</div><div style="float:left; width:10px">&nbsp;</div><div style="float:left; width:12px" onclick="deleteFolder(\''+b+'\')" title="Delete this album">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div></li>');FL[FL.length]=b;cancelCreateFolder()}function populateFolders(){$.ajax({type:"POST",url:"/user/get-folders",data:{},dataType:"json"}).always(function(a){$.each(a,function(d,f){switch(d){case"ERROR":alert(f);break;case"foldersList":var e=new Array(),b=-1;FL=new Array();e[++b]='<ul id=folders style="list-style-type:none; padding-left:6px">';e[++b]='<li class="zoneList" title="common">';e[++b]='<div class="zoneName bgColor" onclick="showContents(\'common\')">common</div></li>';for(var c=0;c<f.length;c++){e[++b]='<li id="f'+f[c]+'" class="zoneList myZones" title="'+f[c]+'">';e[++b]='<div class="zoneName" onclick="showContents(\''+f[c]+"')\">"+f[c]+"</div>";e[++b]='<div style="float:left; width:10px">&nbsp;</div><div style="float:left; width:12px" onclick="deleteFolder(\''+f[c]+'\')" title="Delete this album">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div></li>';FL[c]=f[c]}e[++b]='</ul><ul style="list-style-type:none; padding-left:6px">';e[++b]='<li class="zoneList" title="New Album">';e[++b]='<div class="zoneName" onclick="showCreateFolder()">New Album</div>';e[++b]='</li></ul><div style="clear:both"></div>';$("#foldersDiv").html(e.join(""));break}})})}function uploadImage(c){document.getElementById("imagesMessage").innerHTML="&nbsp;";document.getElementById("imagesMessageTop").innerHTML="&nbsp;";if(!c||!c.type.match(/image.*/)){document.getElementById("imagesMessage").innerHTML="Image type not supported.";return}if(c.size<1024){document.getElementById("imagesMessage").innerHTML="Image too small.";return}if(c.size>5242880){document.getElementById("imagesMessage").innerHTML="Please limit file size to 5MB.";return}uploadImageA.value="Please wait...";var b=new FileReader();b.readAsDataURL(c);var a=new FormData();a.append(selectedFolder.innerHTML,c);$.ajax({type:"POST",url:"/user/upload-image",data:a,processData:false,contentType:false}).always(function(d){if(d=="SUCCESS"){showContents(selectedFolder.innerHTML)}else{document.getElementById("imagesMessage").innerHTML=d}uploadImageA.value="Upload";$("#uploadImageInput").replaceWith($("#uploadImageInput").val("").clone(true))})}function selectImage(a){selectedImageHidden.value=a;for(var b=0;b<IL.length;b++){if(IL[b]==a){document.getElementById(IL[b]).style.backgroundColor="rgb(208, 219, 225)"}else{document.getElementById(IL[b]).style.backgroundColor="white"}}}function chooseImage(){if(selectedImageHidden.value=="NULL"){document.getElementById("imagesMessage").innerHTML="Please select an image.";return false}if(CKEditorFuncNumHidden.value=="PostHeadshot"){var a="https://s3-us-west-2.amazonaws.com/heatbudimages/"+userIdHidden.value+"/thumbs/"+selectedFolder.innerHTML+"/"+selectedImageHidden.value;postHeadshotNewHidden.value=a;document.getElementById("headshotImgDiv").style.backgroundImage="url("+a+")";$("body, #imageBox, #modal-background").toggleClass("active")}else{if(CKEditorFuncNumHidden.value=="S3PostHeadshot"){var a="https://s3-us-west-2.amazonaws.com/heatbudimages/"+userIdHidden.value+"/thumbs/"+selectedFolder.innerHTML+"/"+selectedImageHidden.value;postHeadshotImg.src=a;$("body, #imageBox, #modal-background").toggleClass("active")}else{if(CKEditorFuncNumHidden.value=="ZoneHeadshot"){var a="https://s3-us-west-2.amazonaws.com/heatbudimages/"+userIdHidden.value+"/social/"+selectedFolder.innerHTML+"/"+selectedImageHidden.value;saveZoneHeadshot(a);$("body, #imageBox, #modal-background").toggleClass("active")}else{if(CKEditorFuncNumHidden.value=="ProfilePhoto"){var a="https://s3-us-west-2.amazonaws.com/heatbudimages/"+userIdHidden.value+"/thumbs/"+selectedFolder.innerHTML+"/"+selectedImageHidden.value;saveProfilePhoto(a);$("body, #imageBox, #modal-background").toggleClass("active")}else{if(CKEditorFuncNumHidden.value=="ProfileBG"){var a="https://s3-us-west-2.amazonaws.com/heatbudimages/"+userIdHidden.value+"/images/"+selectedFolder.innerHTML+"/"+selectedImageHidden.value;saveProfileBG(a);$("body, #imageBox, #modal-background").toggleClass("active")}else{if(CKEditorFuncNumHidden.value=="Logo"){var a="https://s3-us-west-2.amazonaws.com/heatbudimages/"+userIdHidden.value+"/images/"+selectedFolder.innerHTML+"/"+selectedImageHidden.value;saveLogo(a);$("body, #imageBox, #modal-background").toggleClass("active")}else{var a="https://s3-us-west-2.amazonaws.com/heatbudimages/"+userIdHidden.value+"/images/"+selectedFolder.innerHTML+"/"+selectedImageHidden.value;window.opener.CKEDITOR.tools.callFunction(CKEditorFuncNumHidden.value,a);window.close()}}}}}}}function selectAndChooseImage(a){selectImage(a);chooseImage()}function deleteImage(){if(selectedImageHidden.value=="NULL"){document.getElementById("imagesMessage").innerHTML="Please select an image.";return false}document.getElementById("imagesMessage").innerHTML="&nbsp;";document.getElementById("imagesMessageTop").innerHTML="&nbsp;";if(confirm('Are you sure "'+selectedImageHidden.value+'" is not being used in the posts or in the profile page?')){$.ajax({type:"POST",url:"/user/delete-image",data:{key:selectedFolder.innerHTML+"/"+selectedImageHidden.value},dataType:"text"}).always(function(b){showContents(selectedFolder.innerHTML);document.getElementById("imagesMessage").innerHTML=b});var a=IL.indexOf(selectedImageHidden.value);IL.splice(a,1);selectedImageHidden.value="NULL"}}function deleteFolder(a){document.getElementById("imagesMessage").innerHTML="&nbsp;";document.getElementById("imagesMessageTop").innerHTML="&nbsp;";if(confirm('Are you sure images from the album "'+a+'" are not being used in the posts or in the profile page?')){$.ajax({type:"POST",url:"/user/delete-folder",data:{key:a+"/"},dataType:"text"}).always(function(c){imagesMessageTop.innerHTML=c;$("#f"+a).remove();var b=FL.indexOf(a);FL.splice(b,1);if(a==selectedFolder.innerHTML){showContents("common")}})}}function showContents(a){$("#images").html('<div style="margin-left:10px; margin-top:30px; font-size:12px">No images in the album.</div>');document.getElementById("imagesMessage").innerHTML="&nbsp;";document.getElementById("imagesMessageTop").innerHTML="&nbsp;";selectedFolder.innerHTML=a;selectedImageHidden.value="NULL";$.ajax({type:"POST",url:"/user/get-images",data:{folderName:selectedFolder.innerHTML},dataType:"json"}).always(function(b){populateImages(b)})}function populateImages(a){$.each(a,function(d,f){switch(d){case"ERROR":alert(f);break;case"imagesList":var e=new Array(),b=-1;IL=new Array();for(var c=0;c<f.length;c++){e[++b]='<table id="'+f[c].name+'" onclick="selectImage(\''+f[c].name+"')\" ondblclick=\"selectAndChooseImage('"+f[c].name+'\')" class="boxedElement" style="width:400px"><tr>';e[++b]='<td><img class="profileThumb" src="https://s3-us-west-2.amazonaws.com/heatbudimages/'+userIdHidden.value+"/thumbs/"+selectedFolder.innerHTML+"/"+f[c].name+'">';e[++b]='</td><td style="vertical-align:top"><div style="margin-left:20px">';e[++b]='<div style="font-weight:bold">'+f[c].name+"</div>";e[++b]='<div style="white-space:pre-line; font-size:12px">'+new Date(f[c].date).toLocaleString()+"</div>";e[++b]="</div></td></tr></table>";IL[c]=f[c].name}if(IL.length!=0){$("#images").html(e.join(""));selectImage(IL[0])}break}})};